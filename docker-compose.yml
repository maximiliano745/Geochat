version: '3.8'

services:
  # Servicio principal de la aplicación (entorno de desarrollo)
  app:
    image: mcr.microsoft.com/devcontainers/go:1.23 
    volumes:
      # Mapea todo el repositorio al contenedor
      - .:/workspaces/Geochat:cached
    ports:
      # Mapeo de puertos para el backend (Go) y el frontend (Vue)
      - 8080:8080
      - 5173:5173
    depends_on:
      - db
    # AÑADIDO: Este comando mantiene el contenedor 'app' vivo 
    # para que Codespaces pueda adjuntarse a él.
    command: sleep infinity
    
  # Servicio de PostgreSQL (Base de datos)
  db:
    image: postgres:15-alpine # Imagen ligera y estable
    restart: always
    environment:
      # Credenciales para que el servicio 'app' se conecte usando Host: 'db'
      POSTGRES_DB: geochat
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      # Persistencia de datos
      - postgres_data:/var/lib/postgresql/data/

volumes:
  postgres_data:
